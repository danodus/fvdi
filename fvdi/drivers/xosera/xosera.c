#include "xosera.h"
short colours[] = {
1000,1000,1000,     0,   0,   0,  1000,   1,   0,     0,1000,   0,  
   0,   0,1000,     0,1000,1000,  1000,1000,   0,  1000,   0,1000,  
 733, 733, 733,   533, 533, 533,   667,   0,   0,     0, 667,   0,  
   0,   0, 667,     0, 667, 667,   667, 667,   0,   667,   0, 667,  
1000,1000,1000,   933, 933, 933,   867, 867, 867,   800, 800, 800,  
 733, 733, 733,   667, 667, 667,   600, 600, 600,   533, 533, 533,  
 467, 467, 467,   400, 400, 400,   333, 333, 333,   267, 267, 267,  
 200, 200, 200,   133, 133, 133,    67,  67,  67,     0,   0,   0,  
1000,   0,   0,  1000,   0,  67,  1000,   0, 133,  1000,   0, 200,  
1000,   0, 267,  1000,   0, 333,  1000,   0, 400,  1000,   0, 467,  
1000,   0, 533,  1000,   0, 600,  1000,   0, 667,  1000,   0, 733,  
1000,   0, 800,  1000,   0, 867,  1000,   0, 933,  1000,   0,1000,  
 933,   0,1000,   867,   0,1000,   800,   0,1000,   733,   0,1000,  
 667,   0,1000,   600,   0,1000,   533,   0,1000,   467,   0,1000,  
 400,   0,1000,   333,   0,1000,   267,   0,1000,   200,   0,1000,  
 133,   0,1000,    67,   0,1000,     0,   0,1000,     0,  67,1000,  
   0, 133,1000,     0, 200,1000,     0, 267,1000,     0, 333,1000,  
   0, 400,1000,     0, 467,1000,     0, 533,1000,     0, 600,1000,  
   0, 667,1000,     0, 733,1000,     0, 800,1000,     0, 867,1000,  
   0, 933,1000,     0,1000,1000,     0,1000, 933,     0,1000, 867,  
   0,1000, 800,     0,1000, 733,     0,1000, 667,     0,1000, 600,  
   0,1000, 533,     0,1000, 467,     0,1000, 400,     0,1000, 333,  
   0,1000, 267,     0,1000, 200,     0,1000, 133,     0,1000,  67,  
   0,1000,   0,    67,1000,   0,   133,1000,   0,   200,1000,   0,  
 267,1000,   0,   333,1000,   0,   400,1000,   0,   467,1000,   0,  
 533,1000,   0,   600,1000,   0,   667,1000,   0,   733,1000,   0,  
 800,1000,   0,   867,1000,   0,   933,1000,   0,  1000,1000,   0,  
1000, 933,   0,  1000, 867,   0,  1000, 800,   0,  1000, 733,   0,  
1000, 667,   0,  1000, 600,   0,  1000, 533,   0,  1000, 467,   0,  
1000, 400,   0,  1000, 333,   0,  1000, 267,   0,  1000, 200,   0,  
1000, 133,   0,  1000,  67,   0,   733,   0,   0,   733,   0,  67,  
 733,   0, 133,   733,   0, 200,   733,   0, 267,   733,   0, 333,  
 733,   0, 400,   733,   0, 467,   733,   0, 533,   733,   0, 600,  
 733,   0, 667,   733,   0, 733,   667,   0, 733,   600,   0, 733,  
 533,   0, 733,   467,   0, 733,   400,   0, 733,   333,   0, 733,  
 267,   0, 733,   200,   0, 733,   133,   0, 733,    67,   0, 733,  
   0,   0, 733,     0,  67, 733,     0, 133, 733,     0, 200, 733,  
   0, 267, 733,     0, 333, 733,     0, 400, 733,     0, 467, 733,  
   0, 533, 733,     0, 600, 733,     0, 667, 733,     0, 733, 733,  
   0, 733, 667,     0, 733, 600,     0, 733, 533,     0, 733, 467,  
   0, 733, 400,     0, 733, 333,     0, 733, 267,     0, 733, 200,  
   0, 733, 133,     0, 733,  67,     0, 733,   0,    67, 733,   0,  
 133, 733,   0,   200, 733,   0,   267, 733,   0,   333, 733,   0,  
 400, 733,   0,   467, 733,   0,   533, 733,   0,   600, 733,   0,  
 667, 733,   0,   733, 733,   0,   733, 667,   0,   733, 600,   0,  
 733, 533,   0,   733, 467,   0,   733, 400,   0,   733, 333,   0,  
 733, 267,   0,   733, 200,   0,   733, 133,   0,   733,  67,   0,  
 467,   0,   0,   467,   0,  67,   467,   0, 133,   467,   0, 200,  
 467,   0, 267,   467,   0, 333,   467,   0, 400,   467,   0, 467,  
 400,   0, 467,   333,   0, 467,   267,   0, 467,   200,   0, 467,  
 133,   0, 467,    67,   0, 467,     0,   0, 467,     0,  67, 467,  
   0, 133, 467,     0, 200, 467,     0, 267, 467,     0, 333, 467,  
   0, 400, 467,     0, 467, 467,     0, 467, 400,     0, 467, 333,  
   0, 467, 267,     0, 467, 200,     0, 467, 133,     0, 467,  67,  
   0, 467,   0,    67, 467,   0,   133, 467,   0,   200, 467,   0,  
 267, 467,   0,   333, 467,   0,   400, 467,   0,   467, 467,   0,  
 467, 400,   0,   467, 333,   0,   467, 267,   0,   467, 200,   0,  
 467, 133,   0,   467,  67,   0,   267,   0,   0,   267,   0,  67,  
 267,   0, 133,   267,   0, 200,   267,   0, 267,   200,   0, 267,  
 133,   0, 267,    67,   0, 267,     0,   0, 267,     0,  67, 267,  
   0, 133, 267,     0, 200, 267,     0, 267, 267,     0, 267, 200,  
   0, 267, 133,     0, 267,  67,     0, 267,   0,    67, 267,   0,  
 133, 267,   0,   200, 267,   0,   267, 267,   0,   267, 200,   0,  
 267, 133,   0,   267,  67,   0,  1000,1000,1000,     0,   0,   0};

void xosera_pset(uint16_t dx, uint16_t dy, uint8_t color)
{
    xv_prep();
    if (dx < 640 && dy < 240)
    {
        uint8_t  uc = color << 4 | color;
        uint16_t addr = dy * (640 / 4) + (dx / 4);
        xm_setw(WR_ADDR, addr);
        xm_setbl(SYS_CTRL, 0x8 >> (dx & 0x3));
        xm_setbh(DATA, uc);
        xm_setbl(DATA, uc);
        xm_setbl(SYS_CTRL, 0x0F);
    }
}

uint8_t xosera_point(uint16_t sx, uint16_t sy)
{
    xv_prep();  
    uint16_t color;
    if (sx < 640 && sy < 240)
    {
        uint16_t addr = sy * (640 / 4) + (sx / 4);
        xm_setw(WR_ADDR, addr);
        color = xm_getw(DATA);
    }
    return color >> ((3 - (sx & 0x3)) * 4);
}